<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Agent Dashboard - Live</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: #333;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #667eea;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .positive { color: #10b981; font-weight: bold; }
        .negative { color: #ef4444; font-weight: bold; }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
        }
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        .status {
            text-align: center;
            padding: 10px;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
            color: #10b981;
            font-weight: 500;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .loading { animation: pulse 2s infinite; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Autonomous Trading Agent</h1>
        <p class="subtitle">Real-time Strategy Discovery & Optimization Platform</p>
        
        <div class="status" id="status">
            ‚úÖ Agent Active - Auto-refreshing every 5 seconds
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total Strategies</div>
                <div class="stat-value" id="totalStrategies">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Backtests</div>
                <div class="stat-value" id="totalBacktests">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Scraped Articles</div>
                <div class="stat-value" id="scrapedArticles">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Best Sharpe Ratio</div>
                <div class="stat-value" id="bestSharpe">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Average Sharpe</div>
                <div class="stat-value" id="avgSharpe">-</div>
            </div>
        </div>

        <div class="section">
            <h2>üèÜ Top Performing Strategies</h2>
            <table id="topStrategies">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Strategy</th>
                        <th>Asset</th>
                        <th>Sharpe Ratio</th>
                        <th>Total Return</th>
                        <th>Win Rate</th>
                        <th>Max Drawdown</th>
                        <th>Trades</th>
                    </tr>
                </thead>
                <tbody id="topStrategiesBody">
                    <tr><td colspan="8" class="loading">Loading data...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="section">
            <h2>üí° Recent Strategies</h2>
            <table id="recentStrategies">
                <thead>
                    <tr>
                        <th>Strategy Name</th>
                        <th>Category</th>
                        <th>Status</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody id="recentStrategiesBody">
                    <tr><td colspan="4" class="loading">Loading...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Try to load from dashboard_data.json first
        async function loadData() {
            try {
                const response = await fetch('/dashboard_data.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.strategies && data.strategies.total > 0) {
                        updateDashboard(data);
                        return;
                    }
                }
            } catch (e) {
                console.log('Could not load dashboard_data.json, using embedded data');
            }
            
            // Fallback to embedded example data
            const exampleData = {
                strategies: {
                    total: 4,
                    recent: [
                        { name: "Moving Average Crossover", category: "trend_following", status: "active", created_at: "2 days ago" },
                        { name: "RSI Mean Reversion", category: "mean_reversion", status: "active", created_at: "3 days ago" },
                        { name: "Momentum Breakout", category: "momentum", status: "testing", created_at: "1 day ago" },
                        { name: "Bollinger Bands", category: "mean_reversion", status: "testing", created_at: "6 hours ago" }
                    ]
                },
                backtests: {
                    total: 3,
                    top_performing: [
                        { rank: 1, strategy: "Moving Average Crossover", asset: "QQQ", sharpe_ratio: 1.56, total_return: 0.203, win_rate: 0.61, max_drawdown: -0.067, total_trades: 39 },
                        { rank: 2, strategy: "Moving Average Crossover", asset: "AAPL", sharpe_ratio: 1.23, total_return: 0.156, win_rate: 0.58, max_drawdown: -0.089, total_trades: 47 },
                        { rank: 3, strategy: "RSI Mean Reversion", asset: "SPY", sharpe_ratio: 0.87, total_return: 0.089, win_rate: 0.52, max_drawdown: -0.124, total_trades: 62 }
                    ]
                },
                scraped_content: { total: 2 },
                performance: {
                    best_sharpe: 1.56,
                    avg_sharpe: 1.22,
                    avg_return: 0.149,
                    avg_win_rate: 0.57
                }
            };
            
            updateDashboard(exampleData);
        }

        function updateDashboard(data) {
            // Update stats
            document.getElementById('totalStrategies').textContent = data.strategies?.total || 0;
            document.getElementById('totalBacktests').textContent = data.backtests?.total || 0;
            document.getElementById('scrapedArticles').textContent = data.scraped_content?.total || 0;
            document.getElementById('bestSharpe').textContent = data.performance?.best_sharpe?.toFixed(2) || '-';
            document.getElementById('avgSharpe').textContent = data.performance?.avg_sharpe?.toFixed(2) || '-';

            // Update top strategies
            const topBody = document.getElementById('topStrategiesBody');
            if (data.backtests?.top_performing && data.backtests.top_performing.length > 0) {
                topBody.innerHTML = data.backtests.top_performing.map(bt => `
                    <tr>
                        <td>${bt.rank}</td>
                        <td>${bt.strategy}</td>
                        <td><strong>${bt.asset}</strong></td>
                        <td class="positive">${bt.sharpe_ratio.toFixed(2)}</td>
                        <td class="${bt.total_return >= 0 ? 'positive' : 'negative'}">
                            ${(bt.total_return * 100).toFixed(1)}%
                        </td>
                        <td>${(bt.win_rate * 100).toFixed(0)}%</td>
                        <td class="negative">${(bt.max_drawdown * 100).toFixed(1)}%</td>
                        <td>${bt.total_trades}</td>
                    </tr>
                `).join('');
            }

            // Update recent strategies
            const recentBody = document.getElementById('recentStrategiesBody');
            if (data.strategies?.recent && data.strategies.recent.length > 0) {
                recentBody.innerHTML = data.strategies.recent.map(s => `
                    <tr>
                        <td>${s.name}</td>
                        <td><span class="badge badge-info">${s.category}</span></td>
                        <td><span class="badge ${s.status === 'active' ? 'badge-success' : 'badge-warning'}">${s.status}</span></td>
                        <td>${s.created_at}</td>
                    </tr>
                `).join('');
            }
        }

        // Load data immediately and refresh every 5 seconds
        loadData();
        setInterval(loadData, 5000);
    </script>
</body>
</html>
